{% macro render_activity(activity) %}

<div class="activity">

{% set obj=activity.child() %}

<div class="activity-icon">

{% set attribution=activity.attributed_object() %}

<img src="{{ attribution.avatar_icon() }}" alt="{{ attribution.name }}">

</div>

<div class="activity-content">{{ render_object(obj) }}</div>

</div>

{% endmacro %}

{% macro render_attachments(obj) %}
<div class="attachments">
{% for att in obj.attachments() %}
<div class="attachment">

{% if att['mediaType'].startswith('image') %}
<a href="{{ att['url'] }}" target="_blank">
  <img src="{{ att['url'] }}" alt="{{ att['name'] }}">
</a>
{% elif att['mediaType'].startswith('video') %}
<video src="{{ att['url'] }}" controls="controls" playsinline=""></video>
{% elif att['mediaType'].startswith('audio') %}
<audio src="{{ att['url'] }}" controls="controls" playsinline=""></video>
{% endif %}

</div>
{% endfor %}
</div>
{% endmacro %}

{% macro render_object(obj) %}

<small class="activity-date">
  <date><a href="{{ app.frontend_support.friendly_uri(obj) }}">{{ obj.published }}</a></date>
</small>

{# XXX: articles #}
{% if obj.summary %}
<h2 class="activity-summary">
  <a href="{{ app.frontend_support.friendly_uri(obj) }}">{{ obj.summary }}</a>
</h2>
{% endif %}

{% set reply=obj.reply() %}

{% if reply %}
{{ render_quote(reply) }}
{% endif %}

{% if obj.attachments() %}
{{ render_attachments(obj) }}
{% endif %}

<div class="content">
{{ obj.content | safe }}
</div>

{% endmacro %}

{% macro render_quote(obj) %}

{% set attribution=obj.attributed_object() %}

<blockquote class="activity-quote">

<div class="attribution">
  <a href="{{ attribution.url or attribution.id }}">
    <span class="attribution-icon">
      <img src="{{ attribution.avatar_icon() }}" alt="{{ attribution.name }}">
    </span>
  </a>
</div>

<div class="content">
{% if obj.attachments() %}
{{ render_attachments(obj) }}
{% endif %}

{{ obj.content | safe }}
</div>

</blockquote>
{% endmacro %}
